<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Configuration Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid #10b981; background: #f0fdf4; }
        .warning { border-left: 4px solid #f59e0b; background: #fffbeb; }
        .error { border-left: 4px solid #ef4444; background: #fef2f2; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
        }
        .config-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .status {
            font-weight: bold;
        }
        .status.ok { color: #10b981; }
        .status.error { color: #ef4444; }
    </style>
</head>
<body>
    <h1>üîç Search Configuration Debug Tool</h1>
    <p>This tool helps verify that your search is using Google Custom Search for discovery and YouTube Data API for metadata.</p>

    <div class="panel">
        <h3>üîë API Configuration Check</h3>
        <div id="api-config"></div>
    </div>

    <div class="panel">
        <h3>‚öôÔ∏è Settings Check</h3>
        <div id="settings-config"></div>
    </div>

    <div class="panel">
        <h3>üß™ Search Test</h3>
        <button onclick="testSearch()">Test Search with "halo"</button>
        <div id="search-results"></div>
    </div>

    <div class="panel">
        <h3>üåê Network Monitor Instructions</h3>
        <p><strong>To verify the correct behavior:</strong></p>
        <ol>
            <li>Open browser DevTools (F12)</li>
            <li>Go to Network tab</li>
            <li>Search for "halo" on your site: <a href="http://localhost:3000/search?q=halo" target="_blank">http://localhost:3000/search?q=halo</a></li>
            <li>Look for these API calls:</li>
            <ul>
                <li><code>googleapis.com/customsearch/v1</code> - For video discovery</li>
                <li><code>googleapis.com/youtube/v3/videos</code> - For metadata enrichment</li>
            </ul>
            <li>Check that view counts in results are real numbers (not "0" or placeholders)</li>
        </ol>
    </div>

    <script>
        // Check API configuration
        function checkApiConfig() {
            const config = document.getElementById('api-config');
            
            // Note: These would be undefined in browser, but we can check if they're likely configured
            const checks = [
                {
                    name: 'YouTube Data API Key',
                    check: 'Check if VITE_YOUTUBE_API_KEY is in .env.local',
                    status: 'manual'
                },
                {
                    name: 'Google Custom Search API Key', 
                    check: 'Check if VITE_GOOGLE_SEARCH_API_KEY is in .env.local',
                    status: 'manual'
                },
                {
                    name: 'Google Search Engine ID',
                    check: 'Check if VITE_GOOGLE_SEARCH_ENGINE_ID is in .env.local',
                    status: 'manual'
                }
            ];

            config.innerHTML = checks.map(item => `
                <div class="config-item">
                    <span>${item.name}</span>
                    <span class="status ${item.status === 'ok' ? 'ok' : 'error'}">${item.check}</span>
                </div>
            `).join('');
        }

        // Check settings
        function checkSettings() {
            const settings = document.getElementById('settings-config');
            
            settings.innerHTML = `
                <div class="config-item">
                    <span>Expected Search Provider</span>
                    <span class="status ok">google-search</span>
                </div>
                <div class="config-item">
                    <span>Expected Behavior</span>
                    <span class="status ok">Google Custom Search + YouTube API metadata</span>
                </div>
                <div class="config-item">
                    <span>Fallback Strategy</span>
                    <span class="status ok">Google Custom Search metadata if YouTube API fails</span>
                </div>
            `;
        }

        // Test search functionality
        async function testSearch() {
            const resultsDiv = document.getElementById('search-results');
            resultsDiv.innerHTML = '<p>Testing search functionality...</p>';

            try {
                // This is a simple test that would need to be run from your actual app
                resultsDiv.innerHTML = `
                    <div class="success">
                        <h4>‚úÖ Test Instructions</h4>
                        <p>To test the search functionality:</p>
                        <ol>
                            <li>Go to <a href="http://localhost:3000/search?q=halo" target="_blank">http://localhost:3000/search?q=halo</a></li>
                            <li>Open browser DevTools Network tab</li>
                            <li>Look for API calls to:</li>
                            <ul>
                                <li><strong>googleapis.com/customsearch/v1</strong> - Discovery</li>
                                <li><strong>googleapis.com/youtube/v3/videos</strong> - Metadata</li>
                            </ul>
                            <li>Verify view counts are real numbers (e.g., 1,234,567 not 0)</li>
                        </ol>
                        <p><strong>Expected behavior:</strong> Real view counts from YouTube Data API, with videos discovered via Google Custom Search.</p>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Test Error</h4>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Initialize checks
        checkApiConfig();
        checkSettings();

        // Add some helpful information
        document.body.insertAdjacentHTML('beforeend', `
            <div class="panel">
                <h3>üìã Configuration Summary</h3>
                <p>Based on your user rule and code analysis, your system should be configured as follows:</p>
                <div class="success">
                    <h4>‚úÖ Current Configuration (Correct)</h4>
                    <ul>
                        <li><strong>Discovery:</strong> Google Custom Search API</li>
                        <li><strong>Metadata:</strong> YouTube Data API v3 (primary) + Google Custom Search (fallback)</li>
                        <li><strong>Provider:</strong> google-search</li>
                        <li><strong>Result:</strong> Real view counts from YouTube's official API</li>
                    </ul>
                </div>
                <p><strong>This configuration follows your rule:</strong> "Use YouTube Data v3 API as the main source for metadata and Google Custom Search as the fallback."</p>
            </div>
        `);
    </script>
</body>
</html>
